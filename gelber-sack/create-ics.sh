#!/bin/bash -e
## Definition der einzelne Bezirke
declare -a district=( "Frauenkopf, Hedelfingen (ohne Hafen), Sillenbuch (mit Riedenberg)" "Feuerbach, Killesberg, Weißenhof" "Möhringen" "Stuttgart-West (ohne Kräherwald, Solitude, Wildpark)" "Stammheim, Weilimdorf" "Hafen, Unter- und Obertürkheim, Wangen" "Münster, Steinhaldenfeld, Zuffenhausen" "Stuttgart-Süd" "Stuttgart-Ost (ohne Frauenkopf)" "Vaihingen (ohne Büsnau, Dürrlewang)" "Bad Cannstatt I (ohne Steinhaldenfeld), Mühlhausen" "Bad Cannstatt II (ohne Steinhaldenfeld)" "Stuttgart-Mitte, Stuttgart-Nord (ohne Killesberg, Weißenhof)" "Birkach, Plieningen, Botnang" "Büsnau, Degerloch, Dürrlewang, Kräherwald, Solitude, Wildpark" )

## Definition der Abholtermine für die einzelne Bezirke
## c&p der Termine aus dem PDF (09.01. 29.01. 19.02. 12.03 ...) 
## Sublime Ersetzen-Strings fuer 2018 Termine:
## FIND:    (\d\d)\.(\d\d)\.
## REPLACE: 2019$2$1
declare -a timetable_0=( 20181231 20190121 20190211 20190304 20190325 20190415 20190506 20190527 20190617 20190708 20190729 20190819 20190909 20190930 20191021 20191111 20191202 20191223 20200113 )
declare -a timetable_1=( 20190102 20190122 20190212 20190305 20190326 20190416 20190507 20190528 20190618 20190709 20190730 20190820 20190910 20191001 20191022 20191112 20191203 20191224 20200114 )
declare -a timetable_2=( 20190103 20190123 20190213 20190306 20190327 20190417 20190508 20190529 20190619 20190710 20190731 20190821 20190911 20191002 20191023 20191113 20191204 20191221 20200115 )
declare -a timetable_3=( 20190104 20190124 20190214 20190307 20190328 20190418 20190509 20190601 20190622 20190711 20190801 20190822 20190912 20191005 20191024 20191114 20191205 20191228 20200116 )
declare -a timetable_4=( 20190105 20190125 20190215 20190308 20190329 20190413 20190510 20190531 20190621 20190712 20190802 20190823 20190913 20191004 20191025 20191115 20191206 20191227 20200117 )
declare -a timetable_5=( 20181217 20190107 20190128 20190218 20190311 20190401 20190427 20190513 20190603 20190624 20190715 20190805 20190826 20190916 20191007 20191028 20191118 20191209 20191230 20200120 )
declare -a timetable_6=( 20181218 20190108 20190129 20190219 20190312 20190402 20190423 20190514 20190604 20190625 20190716 20190806 20190827 20190917 20191008 20191029 20191119 20191210 20191231 20200121 )
declare -a timetable_7=( 20181219 20190109 20190130 20190220 20190313 20190403 20190424 20190515 20190605 20190626 20190717 20190807 20190828 20190918 20191009 20191030 20191120 20191211 20200104 )
declare -a timetable_8=( 20181220 20190110 20190131 20190221 20190314 20190404 20190425 20190516 20190606 20190627 20190718 20190808 20190829 20190919 20191010 20191031 20191121 20191212 20200102 )
declare -a timetable_9=( 20181221 20190111 20190201 20190222 20190315 20190405 20190426 20190517 20190607 20190628 20190719 20190809 20190830 20190920 20191011 20191109 20191122 20191213 20200103 )
declare -a timetable_10=( 20181222 20190114 20190204 20190225 20190318 20190408 20190429 20190520 20190615 20190701 20190722 20190812 20190902 20190923 20191014 20191104 20191125 20191216 20200111 )
declare -a timetable_11=( 20181224 20190115 20190205 20190226 20190319 20190409 20190430 20190521 20190611 20190702 20190723 20190813 20190903 20190924 20191015 20191105 20191126 20191217 20200107 )
declare -a timetable_12=( 20181227 20190116 20190206 20190227 20190320 20190410 20190504 20190522 20190612 20190703 20190724 20190814 20190904 20190925 20191016 20191106 20191127 20191218 20200108 )
declare -a timetable_13=( 20181228 20190117 20190207 20190228 20190321 20190411 20190502 20190523 20190613 20190704 20190725 20190815 20190905 20190926 20191017 20191107 20191128 20191219 20200109 )
declare -a timetable_14=( 20181229 20190118 20190208 20190301 20190322 20190412 20190503 20190524 20190614 20190705 20190726 20190816 20190906 20190927 20191018 20191108 20191129 20191220 20200110 )
for((zaehler=0; zaehler<15; zaehler++)); do
	filename=$(expr $zaehler + 1)
	echo "$filename.ics -> ${district[$zaehler]}"
	# Header einfügen
	cat <<EOT >> $filename.ics
BEGIN:VCALENDAR
METHOD:PUBLISH
VERSION:2.0
URL:http://gelber-sack.jojo3171.de/
X-WR-CALNAME:Gelber Sack Abholtermine
X-WR-TIMEZONE:Europe/Berlin
CALSCALE:GREGORIAN
BEGIN:VTIMEZONE
TZID:Europe/Berlin
BEGIN:DAYLIGHT
TZOFFSETFROM:+0100
RRULE:FREQ=YEARLY;BYMONTH=3;BYDAY=-1SU
DTSTART:19810329T020000
TZNAME:GMT+02:00
TZOFFSETTO:+0200
END:DAYLIGHT
BEGIN:STANDARD
TZOFFSETFROM:+0200
RRULE:FREQ=YEARLY;BYMONTH=10;BYDAY=-1SU
DTSTART:19961027T030000
TZNAME:GMT+01:00
TZOFFSETTO:+0100
END:STANDARD
END:VTIMEZONE
EOT
	echo "">> $filename.ics
	timetable_array="timetable_$zaehler[@]" # Umweg wegen Zähler im Array Namen 
	for i in ${!timetable_array}; do
		echo "BEGIN:VEVENT">> $filename.ics
		echo "DTSTART;VALUE=DATE:$i">> $filename.ics
		echo "DTEND;VALUE=DATE:$i">> $filename.ics
		echo "TRANSP:TRANSPARENT">> $filename.ics
		echo "SUMMARY:Gelber Sack Abholtermin">> $filename.ics
		echo "LOCATION:${district[$zaehler]}">> $filename.ics
		cat <<EOT >> $filename.ics
BEGIN:VALARM
SEQUENCE:1
TRIGGER;VALUE=DURATION:-PT7H
ATTACH;VALUE=URI:Ping
ACTION:AUDIO
END:VALARM
END:VEVENT
EOT
		echo "">> $filename.ics
	done
	echo "END:VCALENDAR">> $filename.ics
done
